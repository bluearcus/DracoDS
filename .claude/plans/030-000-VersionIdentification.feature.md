# Version Identification and Build Tracking

## Overview
This feature provides version visibility in the emulator UI and build output filenames, allowing users to identify which build they are running at a glance.

## Problem Statement
Users need to:
- Know which version of the emulator is running when viewing config menu
- Identify builds by filename to distinguish between different versions
- Report accurate version information when debugging issues
- Track development progress across builds

## Goals
1. Display version number in emulator UI (config menu or main menu)
2. Include version in output filename (e.g., `DracoDS-1.5.0.nds`)
3. Optionally include build metadata (git hash, build date)
4. Maintain single source of truth for version information

## Solution: Version String System

### 1. Define Version Information

**Create version header file**: `arm9/source/version.h`
```c
#ifndef VERSION_H
#define VERSION_H

// Version information
#define EMULATOR_NAME    "DracoDS"
#define VERSION_MAJOR    1
#define VERSION_MINOR    5
#define VERSION_PATCH    0
#define VERSION_SUFFIX   ""  // e.g., "beta", "rc1", or ""

// Automatically generated version string
#define VERSION_STRING   "v1.5.0"  // Or generate: "v1.5.0-beta"

// Full version with build info (optional)
#define VERSION_FULL     "DracoDS v1.5.0"

// Build date (auto-generated by Makefile)
#define BUILD_DATE       __DATE__
#define BUILD_TIME       __TIME__

#endif // VERSION_H
```

### 2. Display Version in Config Menu

**Files to modify**: Config menu rendering code

```c
// Add version display to configuration screen
void draw_config_menu(void) {
    // ... existing menu items ...

    // Display version at bottom of screen
    dsPrintValue(0, 23, 0, VERSION_FULL);
    dsPrintValue(0, 24, 0, "Built: %s", BUILD_DATE);
}
```

**Alternative**: Add to main menu or info screen
```c
// In main menu or help screen
void show_about_screen(void) {
    dsPrintValue(10, 8,  0, "%s", EMULATOR_NAME);
    dsPrintValue(10, 9,  0, "Version: %s", VERSION_STRING);
    dsPrintValue(10, 10, 0, "Built: %s %s", BUILD_DATE, BUILD_TIME);
    dsPrintValue(10, 11, 0, "Dragon DOS Support");
}
```

### 3. Version in Output Filename

**Update Makefile** to include version in output filename:

```makefile
# At top of Makefile
VERSION_MAJOR := 1
VERSION_MINOR := 5
VERSION_PATCH := 0

# Generate version string
VERSION := $(VERSION_MAJOR).$(VERSION_MINOR).$(VERSION_PATCH)

# Output filename with version
TARGET := DracoDS-$(VERSION)

# Build rule generates: DracoDS-1.5.0.nds
$(TARGET).nds: $(TARGET).arm7 $(TARGET).arm9
	ndstool -c $(TARGET).nds -7 $(TARGET).arm7 -9 $(TARGET).arm9 \
	        -b icon.bmp "DracoDS $(VERSION)" -o icon.bmp
```

**Alternative**: Include git commit hash
```makefile
# Get git info
GIT_HASH := $(shell git rev-parse --short HEAD 2>/dev/null || echo "unknown")
GIT_DIRTY := $(shell git diff --quiet 2>/dev/null || echo "-dirty")

# Version with git info
VERSION_FULL := $(VERSION)-$(GIT_HASH)$(GIT_DIRTY)

# Output: DracoDS-1.5.0-abc1234.nds or DracoDS-1.5.0-abc1234-dirty.nds
TARGET := DracoDS-$(VERSION_FULL)
```

### 4. Auto-Generate version.h from Makefile

**Makefile rule to generate version header**:
```makefile
# Generate version.h before building
arm9/source/version.h: FORCE
	@echo "Generating version.h..."
	@echo "#ifndef VERSION_H" > $@
	@echo "#define VERSION_H" >> $@
	@echo "" >> $@
	@echo "#define VERSION_MAJOR $(VERSION_MAJOR)" >> $@
	@echo "#define VERSION_MINOR $(VERSION_MINOR)" >> $@
	@echo "#define VERSION_PATCH $(VERSION_PATCH)" >> $@
	@echo '#define VERSION_STRING "v$(VERSION)"' >> $@
	@echo '#define VERSION_FULL "DracoDS v$(VERSION)"' >> $@
	@echo '#define BUILD_DATE __DATE__' >> $@
	@echo '#define BUILD_TIME __TIME__' >> $@
	@echo '#define GIT_HASH "$(GIT_HASH)"' >> $@
	@echo "" >> $@
	@echo "#endif // VERSION_H" >> $@

FORCE:

# Make ARM9 build depend on version.h
$(BUILD)/DracoDS.o: arm9/source/version.h
```

## Implementation Steps

### Step 1: Create Version Header
1. Create `arm9/source/version.h` manually OR
2. Add Makefile rule to auto-generate it

### Step 2: Update Makefile for Versioned Output
1. Add VERSION variables at top of Makefile
2. Change TARGET to include version
3. Update build rules to use versioned filename

### Step 3: Display Version in UI
1. Include version.h in config menu source
2. Add version display to config screen or about screen
3. Test display formatting

### Step 4: Optional Enhancements
1. Add git commit hash to version
2. Add build timestamp
3. Add "dirty" indicator for uncommitted changes

## Example Output

**Build Output**:
```
Building DracoDS v1.5.0...
Generated: DracoDS-1.5.0.nds
```

**Config Menu Display**:
```
┌─────────────────────────────┐
│  Configuration Menu         │
│                             │
│  Machine Type: Dragon 32    │
│  Auto Load:    Enabled      │
│  ...                        │
│                             │
│  DracoDS v1.5.0             │
│  Built: Jan 28 2026         │
└─────────────────────────────┘
```

## Files to Modify

- `Makefile` - Add VERSION variables and versioned output filename
- `arm9/source/version.h` - Create version header (auto-generated or manual)
- `arm9/source/DracoDS.c` or config menu source - Display version in UI

## Recommended Locations for Version Display
- **Config menu**: Bottom of screen
- **Main menu**: Splash screen or menu footer
- **About/Help screen**: Dedicated info display

## Dependencies
- Makefile build system
- Optional: git (for commit hash in version)

## Benefits
- **Identify builds**: Know exactly which version is running
- **Debug support**: Users can report version number with bugs
- **Development tracking**: Track changes across builds
- **Professional appearance**: Versioned releases

## Testing

### Test 1: Version Display
- Build with version system enabled
- Launch emulator
- Navigate to config menu or about screen
- Verify version string is displayed correctly

### Test 2: Filename Verification
- Build emulator
- Verify output filename includes version: `DracoDS-1.5.0.nds`
- Change version in Makefile
- Rebuild and verify new filename

### Test 3: Version Update
- Increment version number in Makefile
- Rebuild
- Verify UI shows new version
- Verify filename includes new version

### Test 4: Git Integration (Optional)
- Build with uncommitted changes
- Verify filename includes "-dirty" suffix
- Commit changes
- Build again and verify clean version

## Risk Assessment
- **Low Risk**: Version display is purely informational
- **Low Risk**: Makefile changes are isolated to build process
- **No Impact**: Does not affect emulation functionality

## Related Components
- None (standalone feature)
